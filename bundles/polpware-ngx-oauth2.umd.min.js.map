{"version":3,"sources":["ng://@polpware/ngx-oauth2/lib/models/user.model.ts","ng://@polpware/ngx-oauth2/lib/models/permission.model.ts","ng://@polpware/ngx-oauth2/lib/services/oidc-helper.service.ts","ng://@polpware/ngx-oauth2/lib/services/jwt-helper.ts","ng://@polpware/ngx-oauth2/lib/services/auth.service.ts","ng://@polpware/ngx-oauth2/lib/services/auth-guard.service.ts","ng://@polpware/ngx-oauth2/lib/ngx-oauth2.module.ts"],"names":["User","id","userName","fullName","email","jobTitle","phoneNumber","roles","this","Object","defineProperty","prototype","name","Permission","value","groupName","description","viewUsersPermission","manageUsersPermission","viewRolesPermission","manageRolesPermission","assignRolesPermission","OidcHelperService","http","oauthService","configurationServiceProvider","localStoreManagerProvider","clientId","scope","localStorage","get","configurations","baseUrl","loginWithPassword","password","_this","header","HttpHeaders","Content-Type","params","HttpParams","append","issuer","from","loadDiscoveryDocument","pipe","mergeMap","post","tokenEndpoint","headers","refreshLogin","refreshToken","getData","DBkeys","ACCESS_TOKEN","getDataObject","TOKEN_EXPIRES_IN","REFRESH_TOKEN","accessTokenExpiryDate","valueOf","Date","Injectable","HttpClient","OAuthService","ConfigurationServiceAbstractProvider","LocalStoreManagerServiceAbstractProvider","JwtHelper","urlBase64Decode","str","output","replace","length","Error","b64DecodeUnicode","decodeURIComponent","Array","map","call","atob","c","charCodeAt","toString","slice","join","decodeToken","token","parts","split","decoded","JSON","parse","getTokenExpirationDate","hasOwnProperty","date","setUTCSeconds","exp","isTokenExpired","offsetSeconds","AuthService","router","oidcHelperService","previousIsLoggedInCheck","_loginStatus","Subject","initializeLoginStatus","loginUrl","homeUrl","getInitEvent","subscribe","reevaluateLoginStatus","gotoPage","page","preserveParams","navigationExtras","queryParamsHandling","preserveFragment","navigate","gotoHomePage","redirectLoginUser","redirect","loginRedirectUrl","ConfigurationServiceConstants","defaultHomeUrl","urlParamsAndFragment","Utilities","splitInTwo","urlAndParams","firstPart","fragment","secondPart","queryParams","getQueryParamsFromString","redirectLogoutUser","logoutRedirectUrl","redirectForLogin","redirectUrl","url","reLogin","reLoginDelegate","resp","processLoginResponse","rememberMe","isLoggedIn","logout","response","accessToken","access_token","refresh_token","expiresIn","expires_in","tokenExpiryDate","setSeconds","getSeconds","accessTokenExpiry","decodedAccessToken","permissions","isArray","permission","import","configuration","user","sub","fullname","jobtitle","phone_number","role","isEnabled","saveUserDetails","savePermanentData","USER_PERMISSIONS","CURRENT_USER","saveSyncedSessionData","REMEMBER_ME","deleteData","clearLocalChanges","currentUser","setTimeout","next","getLoginStatusEvent","asObservable","isSessionExpired","Router","AuthGuard","authService","canActivate","route","state","checkLogin","canActivateChild","canLoad","path","NgxOauth2Module","NgModule","args","declarations","imports","OAuthModule","exports","providers"],"mappings":"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","sourcesContent":["// =============================\n// Email: info@ebenmonney.com\n// www.ebenmonney.com/templates\n// =============================\n\nexport class User {\n    // Note: Using only optional constructor properties without backing store disables typescript's type checking for the type\n    constructor(id?: string, userName?: string, fullName?: string, email?: string, jobTitle?: string, phoneNumber?: string, roles?: string[]) {\n\n        this.id = id;\n        this.userName = userName;\n        this.fullName = fullName;\n        this.email = email;\n        this.jobTitle = jobTitle;\n        this.phoneNumber = phoneNumber;\n        this.roles = roles;\n    }\n\n\n    get friendlyName(): string {\n        let name = this.fullName || this.userName;\n\n        if (this.jobTitle) {\n            name = this.jobTitle + ' ' + name;\n        }\n\n        return name;\n    }\n\n\n    public id: string;\n    public userName: string;\n    public fullName: string;\n    public email: string;\n    public jobTitle: string;\n    public phoneNumber: string;\n    public isEnabled: boolean;\n    public isLockedOut: boolean;\n    public roles: string[];\n}\n","// =============================\n// Email: info@ebenmonney.com\n// www.ebenmonney.com/templates\n// =============================\n\nexport type PermissionNames =\n    'View Users' | 'Manage Users' |\n    'View Roles' | 'Manage Roles' | 'Assign Roles';\n\nexport type PermissionValues =\n    'users.view' | 'users.manage' |\n    'roles.view' | 'roles.manage' | 'roles.assign';\n\nexport class Permission {\n\n    public static readonly viewUsersPermission: PermissionValues = 'users.view';\n    public static readonly manageUsersPermission: PermissionValues = 'users.manage';\n\n    public static readonly viewRolesPermission: PermissionValues = 'roles.view';\n    public static readonly manageRolesPermission: PermissionValues = 'roles.manage';\n    public static readonly assignRolesPermission: PermissionValues = 'roles.assign';\n\n\n    constructor(name?: PermissionNames, value?: PermissionValues, groupName?: string, description?: string) {\n        this.name = name;\n        this.value = value;\n        this.groupName = groupName;\n        this.description = description;\n    }\n\n    public name: PermissionNames;\n    public value: PermissionValues;\n    public groupName: string;\n    public description: string;\n}\n","// =============================\n// Email: info@ebenmonney.com\n// www.ebenmonney.com/templates\n// =============================\n\nimport { Injectable } from '@angular/core';\nimport { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\nimport { from } from 'rxjs';\nimport { mergeMap } from 'rxjs/operators';\nimport { OAuthService } from 'angular-oauth2-oidc';\n\nimport {\n    ILocalStoreManagerContract,\n    LocalStoreManagerServiceAbstractProvider,\n    IConfigurationServiceContract,\n    ConfigurationServiceAbstractProvider,\n    environment,\n    DBkeys\n} from '@polpware/ngx-appkit-contracts-alpha';\n\nimport { LoginResponse } from '../models/login-response.model';\n\n\n@Injectable()\nexport class OidcHelperService {\n\n    private get baseUrl() { return this.configurations.baseUrl; }\n    private clientId = 'quickapp_spa';\n    private scope = 'openid email phone profile offline_access roles quickapp_api';\n\n    private localStorage: ILocalStoreManagerContract;\n    private configurations: IConfigurationServiceContract;\n\n    constructor(\n        private http: HttpClient,\n        private oauthService: OAuthService,\n        configurationServiceProvider: ConfigurationServiceAbstractProvider,\n        localStoreManagerProvider: LocalStoreManagerServiceAbstractProvider) {\n\n        this.localStorage = localStoreManagerProvider.get();\n        this.configurations = configurationServiceProvider.get();\n\n        /*\n        if (environment.requireHttps !== undefined) {\n            this.oauthService.configure({\n                requireHttps: false\n            });\n        } */\n\n    }\n\n\n    loginWithPassword(userName: string, password: string) {\n        const header = new HttpHeaders({ 'Content-Type': 'application/x-www-form-urlencoded' });\n        const params = new HttpParams()\n            .append('username', userName)\n            .append('password', password)\n            .append('client_id', this.clientId)\n            .append('grant_type', 'password')\n            .append('scope', this.scope);\n\n        this.oauthService.issuer = this.baseUrl;\n\n        return from(this.oauthService.loadDiscoveryDocument())\n            .pipe(mergeMap(() => {\n                return this.http.post<LoginResponse>(this.oauthService.tokenEndpoint, params, { headers: header });\n            }));\n    }\n\n    refreshLogin() {\n        const header = new HttpHeaders({ 'Content-Type': 'application/x-www-form-urlencoded' });\n        const params = new HttpParams()\n            .append('refresh_token', this.refreshToken)\n            .append('client_id', this.clientId)\n            .append('grant_type', 'refresh_token');\n\n        this.oauthService.issuer = this.baseUrl;\n\n        return from(this.oauthService.loadDiscoveryDocument())\n            .pipe(mergeMap(() => {\n                return this.http.post<LoginResponse>(this.oauthService.tokenEndpoint, params, { headers: header });\n            }));\n    }\n\n    get accessToken(): string {\n        return this.localStorage.getData(DBkeys.ACCESS_TOKEN);\n    }\n\n    get accessTokenExpiryDate(): Date {\n        return this.localStorage.getDataObject<Date>(DBkeys.TOKEN_EXPIRES_IN, true);\n    }\n\n    get refreshToken(): string {\n        return this.localStorage.getData(DBkeys.REFRESH_TOKEN);\n    }\n\n    get isSessionExpired(): boolean {\n        if (this.accessTokenExpiryDate == null) {\n            return true;\n        }\n\n        return this.accessTokenExpiryDate.valueOf() <= new Date().valueOf();\n    }\n}\n","// =============================\n// Email: info@ebenmonney.com\n// www.ebenmonney.com/templates\n// =============================\n\n/**\n * Helper class to decode and find JWT expiration.\n */\nimport { Injectable } from '@angular/core';\n\n@Injectable()\nexport class JwtHelper {\n\n    public urlBase64Decode(str: string): string {\n        let output = str.replace(/-/g, '+').replace(/_/g, '/');\n        switch (output.length % 4) {\n            case 0: { break; }\n            case 2: { output += '=='; break; }\n            case 3: { output += '='; break; }\n            default: {\n                throw new Error('Illegal base64url string!');\n            }\n        }\n        return this.b64DecodeUnicode(output);\n    }\n\n    // https://developer.mozilla.org/en/docs/Web/API/WindowBase64/Base64_encoding_and_decoding#The_Unicode_Problem\n    private b64DecodeUnicode(str: any) {\n        return decodeURIComponent(Array.prototype.map.call(atob(str), (c: any) => {\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n    }\n\n    public decodeToken(token: string): any {\n        const parts = token.split('.');\n\n        if (parts.length !== 3) {\n            throw new Error('JWT must have 3 parts');\n        }\n\n        const decoded = this.urlBase64Decode(parts[1]);\n        if (!decoded) {\n            throw new Error('Cannot decode the token');\n        }\n\n        return JSON.parse(decoded);\n    }\n\n    public getTokenExpirationDate(token: string): Date {\n        let decoded: any;\n        decoded = this.decodeToken(token);\n\n        if (!decoded.hasOwnProperty('exp')) {\n            return null;\n        }\n\n        const date = new Date(0); // The 0 here is the key, which sets the date to the epoch\n        date.setUTCSeconds(decoded.exp);\n\n        return date;\n    }\n\n    public isTokenExpired(token: string, offsetSeconds?: number): boolean {\n        const date = this.getTokenExpirationDate(token);\n        offsetSeconds = offsetSeconds || 0;\n\n        if (date == null) {\n            return false;\n        }\n\n        // Token expired?\n        return !(date.valueOf() > (new Date().valueOf() + (offsetSeconds * 1000)));\n    }\n}\n","// =============================\n// Email: info@ebenmonney.com\n// www.ebenmonney.com/templates\n// =============================\n\nimport { Injectable } from '@angular/core';\nimport { Router, NavigationExtras } from '@angular/router';\nimport { Observable, Subject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport {\n    ILocalStoreManagerContract,\n    LocalStoreManagerServiceAbstractProvider,\n    IConfigurationServiceContract,\n    ConfigurationServiceAbstractProvider,\n    Utilities,\n    DBkeys,\n    ConfigurationServiceConstants\n} from '@polpware/ngx-appkit-contracts-alpha';\n\nimport { OidcHelperService } from './oidc-helper.service';\nimport { JwtHelper } from './jwt-helper';\nimport { AccessToken, LoginResponse } from '../models/login-response.model';\nimport { User } from '../models/user.model';\nimport { PermissionValues } from '../models/permission.model';\n\n@Injectable()\nexport class AuthService {\n    public get loginUrl() { return this.configurations.loginUrl; }\n    public get homeUrl() { return this.configurations.homeUrl; }\n\n    public loginRedirectUrl: string;\n    public logoutRedirectUrl: string;\n\n    public reLoginDelegate: () => void;\n\n    private previousIsLoggedInCheck = false;\n    private _loginStatus = new Subject<boolean>();\n\n    private localStorage: ILocalStoreManagerContract;\n    private configurations: IConfigurationServiceContract;\n\n    constructor(\n        private router: Router,\n        private oidcHelperService: OidcHelperService,\n        configurationServiceProvider: ConfigurationServiceAbstractProvider,\n        localStoreManagerProvider: LocalStoreManagerServiceAbstractProvider) {\n\n        this.localStorage = localStoreManagerProvider.get();\n        this.configurations = configurationServiceProvider.get();\n\n        this.initializeLoginStatus();\n    }\n\n    private initializeLoginStatus() {\n        this.localStorage.getInitEvent().subscribe(() => {\n            this.reevaluateLoginStatus();\n        });\n    }\n\n    gotoPage(page: string, preserveParams = true) {\n\n        const navigationExtras: NavigationExtras = {\n            queryParamsHandling: preserveParams ? 'merge' : '', preserveFragment: preserveParams\n        };\n\n        this.router.navigate([page], navigationExtras);\n    }\n\n    gotoHomePage() {\n        this.router.navigate([this.homeUrl]);\n    }\n\n    redirectLoginUser() {\n\n        const redirect = this.loginRedirectUrl && this.loginRedirectUrl != '/' && this.loginRedirectUrl != ConfigurationServiceConstants.defaultHomeUrl ? this.loginRedirectUrl : this.homeUrl;\n        this.loginRedirectUrl = null;\n\n        const urlParamsAndFragment = Utilities.splitInTwo(redirect, '#');\n        const urlAndParams = Utilities.splitInTwo(urlParamsAndFragment.firstPart, '?');\n\n        const navigationExtras: NavigationExtras = {\n            fragment: urlParamsAndFragment.secondPart,\n            queryParams: Utilities.getQueryParamsFromString(urlAndParams.secondPart),\n            queryParamsHandling: 'merge'\n        };\n\n        this.router.navigate([urlAndParams.firstPart], navigationExtras);\n    }\n\n    redirectLogoutUser() {\n        const redirect = this.logoutRedirectUrl ? this.logoutRedirectUrl : this.loginUrl;\n        this.logoutRedirectUrl = null;\n\n        this.router.navigate([redirect]);\n    }\n\n    redirectForLogin(redirectUrl?: string) {\n        if (redirectUrl) {\n            this.loginRedirectUrl = redirectUrl;\n        } else {\n            this.loginRedirectUrl = this.router.url;\n        }\n        this.router.navigate([this.loginUrl]);\n    }\n\n    reLogin() {\n        if (this.reLoginDelegate) {\n            this.reLoginDelegate();\n        } else {\n            this.redirectForLogin();\n        }\n    }\n\n    refreshLogin() {\n        return this.oidcHelperService.refreshLogin()\n            .pipe(map(resp => this.processLoginResponse(resp, this.rememberMe)));\n    }\n\n    loginWithPassword(userName: string, password: string, rememberMe?: boolean) {\n        if (this.isLoggedIn) {\n            this.logout();\n        }\n\n        return this.oidcHelperService.loginWithPassword(userName, password)\n            .pipe(map(resp => this.processLoginResponse(resp, rememberMe)));\n    }\n\n    private processLoginResponse(response: LoginResponse, rememberMe?: boolean) {\n        const accessToken = response.access_token;\n\n        if (accessToken == null) {\n            throw new Error('accessToken cannot be null');\n        }\n\n        rememberMe = rememberMe || this.rememberMe;\n\n        const refreshToken = response.refresh_token || this.refreshToken;\n        const expiresIn = response.expires_in;\n        const tokenExpiryDate = new Date();\n        tokenExpiryDate.setSeconds(tokenExpiryDate.getSeconds() + expiresIn);\n        const accessTokenExpiry = tokenExpiryDate;\n        const jwtHelper = new JwtHelper();\n        const decodedAccessToken = jwtHelper.decodeToken(accessToken) as AccessToken;\n\n        const permissions: PermissionValues[] = Array.isArray(decodedAccessToken.permission) ? decodedAccessToken.permission : [decodedAccessToken.permission];\n\n        if (!this.isLoggedIn) {\n            this.configurations.import(decodedAccessToken.configuration);\n        }\n\n        const user = new User(\n            decodedAccessToken.sub,\n            decodedAccessToken.name,\n            decodedAccessToken.fullname,\n            decodedAccessToken.email,\n            decodedAccessToken.jobtitle,\n            decodedAccessToken.phone_number,\n            Array.isArray(decodedAccessToken.role) ? decodedAccessToken.role : [decodedAccessToken.role]);\n        user.isEnabled = true;\n\n        this.saveUserDetails(user, permissions, accessToken, refreshToken, accessTokenExpiry, rememberMe);\n\n        this.reevaluateLoginStatus(user);\n\n        return user;\n    }\n\n    private saveUserDetails(user: User, permissions: PermissionValues[], accessToken: string, refreshToken: string, expiresIn: Date, rememberMe: boolean) {\n        if (rememberMe) {\n            this.localStorage.savePermanentData(accessToken, DBkeys.ACCESS_TOKEN);\n            this.localStorage.savePermanentData(refreshToken, DBkeys.REFRESH_TOKEN);\n            this.localStorage.savePermanentData(expiresIn, DBkeys.TOKEN_EXPIRES_IN);\n            this.localStorage.savePermanentData(permissions, DBkeys.USER_PERMISSIONS);\n            this.localStorage.savePermanentData(user, DBkeys.CURRENT_USER);\n        } else {\n            this.localStorage.saveSyncedSessionData(accessToken, DBkeys.ACCESS_TOKEN);\n            this.localStorage.saveSyncedSessionData(refreshToken, DBkeys.REFRESH_TOKEN);\n            this.localStorage.saveSyncedSessionData(expiresIn, DBkeys.TOKEN_EXPIRES_IN);\n            this.localStorage.saveSyncedSessionData(permissions, DBkeys.USER_PERMISSIONS);\n            this.localStorage.saveSyncedSessionData(user, DBkeys.CURRENT_USER);\n        }\n\n        this.localStorage.savePermanentData(rememberMe, DBkeys.REMEMBER_ME);\n    }\n\n    logout(): void {\n        this.localStorage.deleteData(DBkeys.ACCESS_TOKEN);\n        this.localStorage.deleteData(DBkeys.REFRESH_TOKEN);\n        this.localStorage.deleteData(DBkeys.TOKEN_EXPIRES_IN);\n        this.localStorage.deleteData(DBkeys.USER_PERMISSIONS);\n        this.localStorage.deleteData(DBkeys.CURRENT_USER);\n\n        this.configurations.clearLocalChanges();\n\n        this.reevaluateLoginStatus();\n    }\n\n    private reevaluateLoginStatus(currentUser?: User) {\n        const user = currentUser || this.localStorage.getDataObject<User>(DBkeys.CURRENT_USER, false);\n        const isLoggedIn = user != null;\n\n        if (this.previousIsLoggedInCheck != isLoggedIn) {\n            setTimeout(() => {\n                this._loginStatus.next(isLoggedIn);\n            });\n        }\n\n        this.previousIsLoggedInCheck = isLoggedIn;\n    }\n\n    getLoginStatusEvent(): Observable<boolean> {\n        return this._loginStatus.asObservable();\n    }\n\n    get currentUser(): User {\n\n        const user = this.localStorage.getDataObject<User>(DBkeys.CURRENT_USER, false);\n        this.reevaluateLoginStatus(user);\n\n        return user;\n    }\n\n    get userPermissions(): PermissionValues[] {\n        return this.localStorage.getDataObject<PermissionValues[]>(DBkeys.USER_PERMISSIONS, false) || [];\n    }\n\n    get accessToken(): string {\n        return this.oidcHelperService.accessToken;\n    }\n\n    get accessTokenExpiryDate(): Date {\n        return this.oidcHelperService.accessTokenExpiryDate;\n    }\n\n    get refreshToken(): string {\n        return this.oidcHelperService.refreshToken;\n    }\n\n    get isSessionExpired(): boolean {\n        return this.oidcHelperService.isSessionExpired;\n    }\n\n    get isLoggedIn(): boolean {\n        return this.currentUser != null;\n    }\n\n    get rememberMe(): boolean {\n        return this.localStorage.getDataObject<boolean>(DBkeys.REMEMBER_ME, false) == true;\n    }\n}\n","// =============================\n// Email: info@ebenmonney.com\n// www.ebenmonney.com/templates\n// =============================\n\nimport { Injectable } from '@angular/core';\nimport { CanActivate, Router, ActivatedRouteSnapshot, RouterStateSnapshot, CanActivateChild, NavigationExtras, CanLoad, Route } from '@angular/router';\nimport { AuthService } from './auth.service';\n\n\n@Injectable()\nexport class AuthGuard implements CanActivate, CanActivateChild, CanLoad {\n    constructor(private authService: AuthService, private router: Router) { }\n\n    canActivate(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n\n        const url: string = state.url;\n        return this.checkLogin(url);\n    }\n\n    canActivateChild(route: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n        return this.canActivate(route, state);\n    }\n\n    canLoad(route: Route): boolean {\n\n        const url = `/${route.path}`;\n        return this.checkLogin(url);\n    }\n\n    checkLogin(url: string): boolean {\n\n        if (this.authService.isLoggedIn) {\n            return true;\n        }\n\n        this.authService.loginRedirectUrl = url;\n        this.router.navigate(['/login']);\n\n        return false;\n    }\n}\n","import { NgModule } from '@angular/core';\n\nimport { OAuthModule, OAuthStorage } from 'angular-oauth2-oidc';\n\nimport { OidcHelperService } from './services/oidc-helper.service';\nimport { AuthService } from './services/auth.service';\nimport { JwtHelper } from './services/jwt-helper';\nimport { AuthGuard } from './services/auth-guard.service';\n\n\n@NgModule({\n    declarations: [],\n    imports: [\n        OAuthModule,\n    ],\n    exports: [],\n    providers: [\n        OidcHelperService,\n        AuthService,\n        JwtHelper,\n        AuthGuard\n    ]\n})\nexport class NgxOauth2Module { }\n"]}